<mat-toolbar color="primary">
  <span>Shift Management</span>
</mat-toolbar>

<mat-tab-group>
  <mat-tab label="Assignment">
    <mat-card>
      <mat-card-content>
        <form (ngSubmit)="addShift()">
          <mat-form-field>
            <mat-label>ชื่อ</mat-label>
            <input 
                type="text" 
                matInput 
                [matAutocomplete]="auto" 
                [(ngModel)]="selectedUser" 
                [ngModelOptions]="{standalone: true}"
                (input)="filterUsers($event)">
                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayUser">
                  <mat-option *ngFor="let user of filteredUsers" [value]="user">
                      {{ user.firstname }} {{ user.lastname }}
                  </mat-option>
              </mat-autocomplete>              
        </mat-form-field>
        
          
          <mat-form-field>
            <mat-label>ประเภท</mat-label>
            <mat-select [(ngModel)]="type" name="type">
                <mat-option *ngFor="let assignment of assignments" [value]="assignment.name">
                    {{ assignment.name }}
                </mat-option>
            </mat-select>
          </mat-form-field>


          <mat-form-field>
            <mat-label>สถานที่</mat-label>
              <input 
                  type="text" 
                  matInput 
                  [matAutocomplete]="hospitalsAuto" 
                  [(ngModel)]="hospitals" 
                  [ngModelOptions]="{standalone: true}"
                  (input)="filterWorkSites($event)">
              <mat-autocomplete #hospitalsAuto="matAutocomplete">
                <mat-option *ngFor="let hospital of filteredWorkSites" [value]="hospital.site_name">
                  {{ hospital.site_name }}
                </mat-option>
              </mat-autocomplete>
           </mat-form-field>
            <ng-container>      
            <mat-form-field>
              <mat-label>Start Date and Time</mat-label>
              <div fxLayout="row" fxLayoutGap="10px">
                  <input fxFlex matInput [(ngModel)]="startDate" name="startDate" type="date">
                  <input fxFlex matInput [(ngModel)]="startTime" name="startTime" type="time">
              </div>
          </mat-form-field>
          <mat-form-field>
            <mat-label>End Date and Time</mat-label>
            <div fxLayout="row" fxLayoutGap="10px">
                <input fxFlex matInput [(ngModel)]="endDate" name="endDate" type="date">
                <input fxFlex matInput [(ngModel)]="endTime" name="endTime" type="time">
            </div>
           </mat-form-field>
          </ng-container>

          <button mat-raised-button color="primary" type="submit">Add Shift</button>
        </form>
        <!-- <mat-form-field>
          <mat-label>ค้นหา</mat-label>
          <input matInput [(ngModel)]="filterText" (input)="filterShifts()" placeholder="ค้นหา...">
        </mat-form-field> -->
            
         <table class="my-table">
          <thead> 
             <tr>
              <th (click)="sortTable('index')">ลำดับที่</th>
              <th (click)="sortTable('date')">วันที่ <span>{{ sortField === 'date' ? (sortAscending ? '▲' : '▼') : '↕' }}</span></th>
              <th (click)="sortTable('time')">เวลา</th>
              <th (click)="sortTable('person_name')">ชื่อ-นามสกุล <span>{{ sortField === 'person_name' ? (sortAscending ? '▲' : '▼') : '↕' }}</span></th>
              <th (click)="sortTable('type')">ประเภท <span>{{ sortField === 'type' ? (sortAscending ? '▲' : '▼') : '↕' }}</span></th> <!-- Add this line -->
              <th (click)="sortTable('hospital')">สถานที่ <span>{{ sortField === 'hospital' ? (sortAscending ? '▲' : '▼') : '↕' }}</span></th>
            </tr>
          </thead> 
          <tbody>
            <tr *ngFor="let shift of shifts; let i = index">
              <td>{{ i+1 }}</td>
              <td>
                <ng-container *ngIf="shift.start_date || shift.end_date; else noData">
                  {{ shift.start_date ? (shift.start_date | date:'dd/MM/yyyy') : '-' }} - {{ shift.end_date ? (shift.end_date | date:'dd/MM/yyyy') : '-' }}
                </ng-container>
                <ng-template #noData>-</ng-template>
              </td>              
              <td>
                {{ (shift.start_time || shift.end_time) ? (shift.start_time ? shift.start_time : '-') + ' - ' + (shift.end_time ? shift.end_time : '-') : '-' }}
              </td>              
              <td>{{ shift.person_name }}</td>
              <td>{{ shift.type }}</td>
              <td>{{ shift.hospital || '-' }}</td>
            </tr>
          </tbody>
        </table> 
      

        
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="User Profile">
    <mat-card>
      <mat-card-title>User Profile</mat-card-title>
      <mat-card-content>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="Dashboard">
    <div>
      <mat-toolbar color="primary">
        <span>Shift Management - Admin Dashboard</span>
        <span class="spacer"></span>
        <button mat-button [matMenuTriggerFor]="menu">Menu</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item>Dashboard</button>
          <button mat-menu-item>จัดการ User</button>
          <button mat-menu-item>จัดการ Shift</button>
          <button mat-menu-item>จัดการ On-Site</button>
          <button mat-menu-item>จัดการ Hospital</button>
        </mat-menu>
      </mat-toolbar>
      <div class="container">
        <div class="summary">
          <mat-card>
            <mat-card-title>Dashboard Summary</mat-card-title>
            <mat-card-content>
              <div *ngIf="dashboardSummary">
 
                <div *ngFor="let item of dashboardSummary">
                  {{ item.summary }}: {{ item.value }}
                </div>
              </div>
            </mat-card-content>
            
          </mat-card>
        </div>
    
        <div class="calendar-view">

        </div>
        <div class="grid-view">
        </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>


